<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In The Middle - Middle School Newspaper Homepage</title>
    <!-- Load Tailwind CSS for utility styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Google Fonts for Merriweather (Primary) and Open Sans (Secondary) -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700;900&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Define Brand Colors and Fonts based on the Brand Guide */
        :root {
            --color-navy: #003057;      /* Primary: Blue (Navy) */
            --color-light-blue: #9BCBEB; /* Secondary: Light Blue */
            --font-primary: 'Merriweather', serif; /* Website Typeface 1 */
            --font-secondary: 'Open Sans', sans-serif; /* Website Typeface 2 */
        }
        .text-navy { color: var(--color-navy); }
        .bg-navy { background-color: var(--color-navy); }
        .text-light-blue { color: var(--color-light-blue); }
        .border-light-blue { border-color: var(--color-light-blue); }
        .hover\:bg-light-blue-100:hover { background-color: rgba(155, 203, 235, 0.1); } /* Light hover effect */
        .bg-light-blue-fade { background-color: rgba(155, 203, 235, 0.2); } /* Faded background for notes */
        .font-primary { font-family: var(--font-primary); }
        .font-secondary { font-family: var(--font-secondary); }

        /* Custom scrollbar for newspaper/magazine feel */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f0f0f0; }
        ::-webkit-scrollbar-thumb { background: var(--color-light-blue); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-navy); }

        /* General layout ensures full width and responsive design */
        body {
            background-color: #f7f9fb; /* Off-white background */
            font-family: var(--font-secondary);
        }

        /* Modal specific styling */
        .modal-overlay {
            z-index: 1000;
            background-color: rgba(0, 0, 0, 0.75);
            transition: opacity 0.3s ease;
        }

        .modal-content {
            max-height: 90vh;
            max-width: 95vw;
            width: 800px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Interactive Card Hover Effect */
        .article-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .article-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 48, 87, 0.1), 0 4px 6px -2px rgba(0, 48, 87, 0.05);
        }
        /* Floating tooltip (document-level) */
.tooltip-floating {
  position: fixed;
  background-color: var(--color-navy);
  color: #fff;
  padding: 8px 10px;
  border-radius: 8px;
  font-size: 0.9rem;
  line-height: 1.2;
  z-index: 99999;
  pointer-events: none;
  max-width: 320px;
  text-align: left;
  transform: translate(-50%, -100%) scale(0.98);
  opacity: 0;
  transition: opacity 0.18s ease, transform 0.18s ease;
  box-shadow: 0 6px 18px rgba(0,0,0,0.18);
}

.homepage-subtitle {
  font-family: "Times New Roman", serif;
  font-size: 1.15em;
  color: #0d47a1;
  text-align: center;
  margin-top: -0.3em;
  margin-bottom: 1.8em;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.45;
}
        
        
.tooltip-floating.visible {
  opacity: 1;
  transform: translate(-50%, -120%) scale(1);
}

.tooltip-floating::after {
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: -6px;
  border-width: 6px;
  border-style: solid;
  border-color: var(--color-navy) transparent transparent transparent;
}
        .tooltip .tooltiptext {
  display: none;
}
        
    </style>
</head>
<body class="antialiased p-4 sm:p-8">

    <!-- Header Section - Uses Navy Primary Color. Title Centered -->
    <header class="mb-8 border-b-4 border-navy pb-4 text-center">
        <h1 class="text-4xl sm:text-6xl font-black font-primary text-navy tracking-tight">
            In The Middle
        </h1>
        <p class="text-xl sm:text-2xl font-secondary text-gray-600 mt-2">
            The Episcopal Academy MS Newspaper
        </p>
    </header>
    <!-- Admin/Editor Mode Toggle Button - CURRENTLY DISABLED -->
    
    <!-- <div class="text-center mb-6">
        <button onclick="toggleAdminMode()" id="admin-toggle-btn" 
                class="bg-light-blue text-navy hover:bg-light-blue-100 font-semibold py-2 px-4 rounded-full text-sm transition-colors border-2 border-light-blue shadow-md">
            - WIP -
        </button>
    </div> -->

    <!-- Admin/Editor Mode Interface (Hidden by Default) -->
    <div id="admin-editor-mode" class="hidden mb-10 p-6 border-4 border-light-blue rounded-xl bg-white max-w-7xl mx-auto">
        <h2 class="text-2xl font-primary font-bold text-navy mb-4 border-b pb-2">Section Data Editor</h2>
        <p class="mb-4 text-sm text-gray-700 font-secondary">
            This feature is not available right now, please refrain from using this until it is deleted or usable. -VT
            <span class="font-bold text-red-600">IMPORTANT:</span> This editor is designed to be able to edit the site permanently. Currently, it does not serve this function. -VT
        </p>
        
        <textarea id="article-json-editor" class="w-full h-96 p-4 border border-gray-300 rounded-lg font-mono text-xs focus:ring-light-blue focus:border-light-blue transition-colors"></textarea>
        
        <div class="mt-4 flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-4">
            <button onclick="loadArticles(true)" 
                    class="bg-navy text-white hover:bg-navy/90 font-semibold py-3 px-6 rounded-lg transition-colors shadow-lg">
                Update Live Preview
            </button>
            <button onclick="generateCodeSnippet()" 
                    class="bg-green-500 text-white hover:bg-green-600 font-semibold py-3 px-6 rounded-lg transition-colors shadow-lg">
                Copy New Source Code to Clipboard
            </button>
        </div>

        <!-- Code Snippet Output Area (Hidden until generated) -->
        <div id="code-snippet-output" class="hidden mt-6">
            <h3 class="text-lg font-primary font-bold text-navy mb-2">New Code Snippet for Google Site Embed:</h3>
            <textarea id="generated-code" class="w-full h-40 p-4 border border-green-500 bg-green-50 rounded-lg font-mono text-xs" readonly></textarea>
            <p class="text-sm text-red-500 mt-2">
                <span class="font-bold">Next Steps:</span> 1. Copy the code above. 2. Go to your Google Site embed source. 3. Replace the old `const articles = {...}` block with this new one.
            </p>
        </div>
    </div>


    <!-- Main Content Grid - Adjusted to lg:grid-cols-3 for better visual balance with 5 items -->
    <main id="article-grid" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 justify-center mx-auto max-w-7xl">
        <!-- Sections will be generated here by JavaScript -->
        <p id="loading-message" class="col-span-full text-center text-gray-500">Loading articles...</p>
    </main>

    <!-- Modal Structure (Hidden by default) -->
    <div id="article-modal" class="modal-overlay fixed inset-0 flex items-center justify-center opacity-0 pointer-events-none transition-opacity">
        <div class="modal-content bg-white rounded-xl shadow-2xl p-6 overflow-y-auto">
            <!-- Modal Header -->
            <div class="flex justify-between items-start border-b border-light-blue pb-3 mb-4 sticky top-0 bg-white">
                <h3 id="modal-title" class="text-2xl font-primary font-extrabold text-navy"></h3>
                <button onclick="closeModal()" class="text-navy hover:text-red-500 transition-colors p-1 -mt-1 -mr-1 rounded-full hover:bg-gray-100" aria-label="Close section info">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Modal Body (Section Content) -->
            <div id="modal-content-body" class="text-gray-800 font-secondary leading-relaxed text-base">
                <!-- Content will be injected here -->
            </div>
            <div class="mt-6 pt-4 border-t border-gray-200">
                 <p class="text-sm text-gray-600 font-semibold">Hover over an article to preview it. Click on it to navigate directly to the article.</p>
            </div>
        </div>
    </div>

    <script>
        // Floating tooltip script
(function() {
  const floatTip = document.createElement('div');
  floatTip.className = 'tooltip-floating';
  document.body.appendChild(floatTip);

  let activeTarget = null;
  let hideTimeout = null;

 function showTip(target, html) {
  floatTip.classList.add('visible');
  clearTimeout(hideTimeout); // cancel any scheduled hide
  if (!html) return;
  activeTarget = target;
  floatTip.innerHTML = html;
  floatTip.style.opacity = '1';
  floatTip.style.transform = 'translate(-50%, -120%)';
  positionTipOverElement(target);
}

function hideTip(withDelay = true) {
  activeTarget = null;
  const doHide = () => {
    floatTip.classList.remove('visible');
    // reset transform for the next animation cycle
    floatTip.style.transform = 'translate(-50%, -100%) scale(0.98)';
    // force opacity back to 0 so it disappears even if transition is skipped
    floatTip.style.opacity = '0';
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(() => {
      floatTip.innerHTML = '';
    }, 220); // wait for fade-out transition
  };

  if (withDelay) {
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(doHide, 120);
  } else {
    doHide();
  }
}

  function positionTipOverElement(target) {
    if (!target) return;
    const rect = target.getBoundingClientRect();
    const x = rect.left + rect.width / 2;
    let y = rect.top - 10;
    if (y - 60 < 0) y = rect.bottom + 10;
    floatTip.style.left = `${x}px`;
    floatTip.style.top = `${y}px`;
  }

  window.addEventListener('scroll', () => {
    if (activeTarget) positionTipOverElement(activeTarget);
  }, { passive: true });
  window.addEventListener('resize', () => {
    if (activeTarget) positionTipOverElement(activeTarget);
  });

  document.body.addEventListener('pointerenter', (e) => {
    const t = e.target.closest('.tooltip');
    if (!t) return;
    const tt = t.querySelector('.tooltiptext');
    if (!tt) return;
    showTip(t, tt.innerHTML);
  }, true);

document.body.addEventListener('pointerleave', (e) => {
  const t = e.target.closest('.tooltip');
  const toEl = e.relatedTarget && e.relatedTarget.closest
    ? e.relatedTarget.closest('.tooltip')
    : null;
  if (!t) return;
  if (toEl) return; // moving to another tooltip
  hideTip(true);
}, true);

  document.body.addEventListener('pointermove', (e) => {
    if (!activeTarget) return;
    positionTipOverElement(activeTarget);
  });
})();
        // This section ctains all of the module areas, edit this per edition
        // LAST EDIT- 2025F
        let articles = {
            news: {
                title: "News & Features",
                description: "The section with all of the latest campus news! Includes policy changes, student activity, trips, and more!",
                category: "Section",
                image: "https://www.phillymag.com/wp-content/uploads/sites/57/2024/09/Campus-Green-Chapel-Crowds-ps.jpg",
                content: `
                    <p class="mb-4">This is the <strong>News & Features</strong> section. Here, we cover major school announcements, student achievements, and deep-dive features into campus life. The council corner is also hosted here, where all of the latest StuCo activities are posted!</p>
                    <p class="font-bold text-lg text-navy mb-2">In This Edition:</p>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>
            <span class="tooltip"><u><strong><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/news-features/washington-d-c-trip?authuser=1" target="_blank" class="article-title">8th Grade Washington D.C. Trip</a></strong></u>
                <span class="tooltiptext">All about the Washington D.C. Trip! Authors: <i>Adam, Leo, Zach, Ellen</i></span>
            </span>
        </li>
                       <li>
            <span class="tooltip"><u><strong><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/news-features/the-council-corner?authuser=1" target="_blank" class="article-title">The Council Corner</a></strong></u>
                <span class="tooltiptext">The hottest news from the Student Council! Authors: <i>Gus, Ellen</i></span>
            </span>
        </li>
                        <li>
            <span class="tooltip"><u><strong><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/news-features/stuco-game-night?authuser=1" target="_blank" class="article-title">StuCo Game Night</a></strong></u>
                <span class="tooltiptext">A night of fun games from the Student Council. Authors: <i>Sara Adibi</i></span>
            </span>
        </li>
                        <li>
            <span class="tooltip"><u><strong><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/news-features/echo-hill-trip?authuser=1" target="_blank" class="article-title">7th Grade Echo Hill Trip</a></strong></u>
                <span class="tooltiptext">All about the 7th Grade Echo Hill Trip. Authors: <i>Sara Adibi</i></span>
            </span>
        </li>
                        <li>
            <span class="tooltip"><u><strong><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/news-features/costume-contest?authuser=1" target="_blank" class="article-title">Costume Contest</a></strong></u>
                <span class="tooltiptext">A contest in the Middle School for the best costumes! Authors: <i>Sara Adibi, Lindsay Ferry</i></span>
                    </ul>
                `,
                author: ""
            },
            opinion: {
                title: "Fun & Games",
                description: "The place for puzzles, riddles, polls, and more!",
                category: "Section",
                image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/14/CrosswordUSA.svg/1200px-CrosswordUSA.svg.png",
                content: `
                    <p class="mb-4">The <strong>Fun & Games</strong> section is where all of the games made by our staff go! This may include word searches, crosswords, fun facts, and more! In addition, polls from the EA community will be paced here. Does everyone agree?</p>
                    <p class="font-bold text-lg text-navy mb-2">In This Edition:</p>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>
            <span class="tooltip"><strong><u><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/fun-games/puzzles?authuser=1" target="_blank" class="article-title">Crossword/Wordsearch and other Puzzles</a></u></strong>
                <span class="tooltiptext">Various puzzles created by our staff!</span>
            </span>
        </li>

                    </ul>
                `,
                author: ""
            },
            athletics: {
                title: "Sports & Athletics",
                description: "Scores, team highlights, and spotlights on middle school athletes across all seasonal sports.",
                category: "Section",
                image: "https://resources.finalsite.net/images/f_auto,q_auto,t_image_size_6/v1747664955/episcopalacademypa/m2tmbt97ckopdavsuhx2/athlanding1.jpg",
                content: `
                    <p class="mb-4">Welcome to the <strong>Sports & Athletics</strong> hub. We provide full game recaps, coach interviews, and look ahead at upcoming match-ups.</p>
                    <p class="font-bold text-lg text-navy mb-2">In This Edition:</p>
                    <ul class="list-disc pl-5 space-y-1">
                        <li>
            <span class="tooltip"><strong><u><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/sports-athletics/fall-season-overview?authuser=1" target="_blank" class="article-title">Fall Sports Season Overview</a></u></strong>
                <span class="tooltiptext">A summary of the EAMS Fall Athletics! Authors: <i>Emme, Maya, Gus</i></span>
            </span>
        </li>
                        <li>
            <span class="tooltip"><strong><u><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/sports-athletics/ms-girls-tennis?authuser=1" target="_blank" class="article-title">MS Girls Tennis (Team Spotlight)</a></u></strong>
                <span class="tooltiptext">A dive into the MS Girls Tennis team. Authors: <i>Grace, Campbell, Ava, Florrie</i></span>
            </span>
        </li>
                        <li>
            <span class="tooltip"><strong><u><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/sports-athletics/girls-volleyball?authuser=1" target="_blank" class="article-title">Girls Volleyball (Team Spotlight)</a></u></strong>
                <span class="tooltiptext">All about this year's Girls Volleyball team. Authors: <i>Sunishka, Ellie</i></span>
            </span>
        </li>
                        <li>
            <span class="tooltip"><strong><u><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/sports-athletics/aishaverford-day?authuser=1" target="_blank" class="article-title">AIS/Haverford Day</a></u></strong>
                <span class="tooltiptext">A full rundown about the events of AIS/Haveford Day and Weekend! (Spoiler: we won!) Authors: <i>Asha, Sara</i></span>
            </span>
        </li>
                    </ul>
                `,
                author: ""
            },
            arts: {
                title: "Arts & Culture",
                description: "Coverage of theater productions, art shows, band concerts, and creative student work.",
                category: "Section",
                image: "https://resources.finalsite.net/images/f_auto,q_auto,t_image_size_6/v1747664950/episcopalacademypa/c19kays4aib1z3aoljip/artscccg.jpg",
                content: `
                    <p class="mb-4">The <strong>Arts & Culture</strong> section celebrates creativity! Find reviews, interviews, and features on student artists, musicians, and performers.</p>
                    <p class="font-bold text-lg text-navy mb-2">In This Edition:</p>
                    <ul class="list-disc pl-5 space-y-1">
                       <li>
            <span class="tooltip"><strong><u><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/arts-and-culture/newsies?authuser=1" target="_blank" class="article-title">Newsies - The Fall Musical</a></u></strong>
                <span class="tooltiptext">The MS Fall Musical; here's what you need to know! Authors: <i>Eleanor</i></span>
            </span>
        </li>
                        <li>
            <span class="tooltip"><strong><u><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/arts-and-culture/jazz-band?authuser=1" target="_blank" class="article-title">Jazz Band</a></u></strong>
                <span class="tooltiptext">An overview of the MS Jazz Band. Author: <i>Leo Wang</i></span>
            </span>
        </li>
                        <li>
            <span class="tooltip"><u><strong><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/arts-and-culture/symphonic-band?authuser=1" target="_blank" class="article-title">Symphonic Band</a></u></strong>
                <span class="tooltiptext">The Symphonic band and everything about it. Authors: <i>Adam, Leo, Zach, Ellen</i></span>
            </span>
        </li>
                        <li>
            <span class="tooltip"><strong><u><a href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/arts-and-culture/ms-singers?authuser=1" target="_blank" class="article-title">MS Singers</a></u></strong>
                <span class="tooltiptext">A summary of the MS Singers. What will they perform? Authors: <i>Grace, Florrie</i></span>
            </span>
        </li>
                        
                    </ul>
                `,
                author: ""
            },
            join: {
                title: "Join the Staff!",
                description: "Are you interested in writing, photography, or editing? See how you can get involved!",
                category: "Opportunity",
                image: "https://lh3.google.com/u/0/d/1C-eS_ieobBY6dsFGnCO2dQDVXAFrx2_Q=w3270-h1824-iv1?auditContext=thumbnail&auditContext=forDisplay",
                content: `
                    <p class="text-lg font-bold text-navy mb-4">Are you interested in being on the Newspaper staff?</p>
                    <p class="mb-6">We are still looking for dedicated <span class="font-bold">writing staff and photographers</span> to help us cover all the exciting news around the school!</p>

                    <h4 class="text-xl font-primary font-bold text-navy mb-2">《 Head Newspaper Staff 》</h4>
                    <ul class="list-disc pl-5 space-y-2 mb-6">
                        <li><strong>Faculty Advisors:</strong> Ms. Silberman and Ms. McGill</li>
                        <li><strong>Editors-in-Chief:</strong> Ellen Le ('30) and Sara Adibi ('31)</li>
                        <li><strong>Content Editors:</strong> Leo Wang ('30) and Victor Tsai ('30)</li>
                    </ul>

                    <p class="text-base">
                        Reach out to <span class="font-bold">Ms. McGill</span> at 
                        <a href="mailto:mmcgill@episcopalacademy.org" class="text-light-blue hover:text-navy font-semibold underline">mmcgill@episcopalacademy.org</a> 
                        or <span class="font-bold">Ellen Le</span> at <a href="mailto:lee30@episcopalacademy.org" class="text-light-blue hover:text-navy font-semibold underline">lee30@episcopalacademy.org</a> for more information and to find out how you can contribute.
                    </p>
                `,
                author: ""
            },
            archive: {
    title: "Archive",
    description: "View past issues of the newspaper.",
    category: "Archive",
    image: "https://example.com/archive-image.jpg",
    content: `
        <p class="text-lg font-bold text-navy mb-4">Past Issues</p>
        <p class="mb-6">
            You can browse all previous editions of the newspaper on our archive page.
        </p>

        <a 
            href="https://sites.google.com/episcopalacademy.org/inthemiddle-eamsnewspaper/in-the-middle/archive" 
            class="text-light-blue underline font-semibold hover:text-navy"
        >
            Go to the full archive →
        </a>
    `,
    author: ""
}
        };

        const modal = document.getElementById('article-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-content-body');
        const articleGrid = document.getElementById('article-grid');
        const body = document.body;
        const editorMode = document.getElementById('admin-editor-mode');
        const jsonEditor = document.getElementById('article-json-editor');
        const loadingMessage = document.getElementById('loading-message');
        const toggleBtn = document.getElementById('admin-toggle-btn');


        /**
         * Renders the article grid based on the current 'articles' (now sections) object.
         * @param {boolean} showSuccess - Whether to show a success message after loading.
         */
        function loadArticles(showSuccess = false) {
            articleGrid.innerHTML = ''; // Clear existing content
            loadingMessage.classList.add('hidden');
            let hasArticles = false;

            try {
                // 1. If called from the editor, update the 'articles' object from the JSON text area
                if (showSuccess) {
                    articles = JSON.parse(jsonEditor.value);
                }

                // 2. Iterate through the articles object and build the HTML card for each.
                for (const key in articles) {
                    if (articles.hasOwnProperty(key)) {
                        const section = articles[key];
                        hasArticles = true;
                        
                        const cardHtml = `
                            <div class="article-card bg-white rounded-xl overflow-hidden shadow-lg border border-gray-100 hover:border-light-blue-100 cursor-pointer" onclick="openModal('${key}')">
                                <!-- Image with fallback placeholder logic -->
                                <img class="w-full h-48 object-cover object-center" 
                                     src="${section.image || 'https://placehold.co/600x400/f0f0f0/666666?text=NO+IMAGE'}" 
                                     alt="${section.title}" 
                                     onerror="this.onerror=null;this.src='https://placehold.co/600x400/f0f0f0/666666?text=NO+IMAGE';">
                                
                                <div class="p-6 h-full flex flex-col justify-between">
                                    <div>
                                        <!-- Card Title is now the Section Title -->
                                        <p class="text-xs font-semibold uppercase text-light-blue mb-1">${section.category || 'Section'}</p>
                                        <h2 class="text-xl font-primary font-extrabold text-navy leading-snug">
                                            ${section.title || 'Untitled Section'}
                                        </h2>
                                        <!-- Card Description is the Section Summary -->
                                        <p class="text-gray-700 mt-3 line-clamp-3 font-secondary text-sm">
                                            ${section.description || 'Click to view the details for this section.'}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `;
                        articleGrid.insertAdjacentHTML('beforeend', cardHtml);
                    }
                }

                if (!hasArticles) {
                    articleGrid.innerHTML = '<p class="col-span-full text-center text-gray-500 py-10">No sections found in the current edition.</p>';
                }

                if (showSuccess) {
                    toggleBtn.textContent = 'Sections Updated! Click to Close Editor';
                    toggleBtn.classList.add('bg-green-500', 'hover:bg-green-600', 'text-white', 'border-green-500');
                    setTimeout(() => {
                        toggleBtn.classList.remove('bg-green-500', 'hover:bg-green-600', 'text-white', 'border-green-500');
                        toggleBtn.classList.add('bg-light-blue', 'text-navy', 'border-light-blue');
                        toggleBtn.textContent = 'Disable Editor Mode';
                    }, 3000);
                }
            } catch (error) {
                articleGrid.innerHTML = `<p class="col-span-full text-center text-red-600 py-10 font-bold">Error loading sections: Invalid JSON format.</p><p class="col-span-full text-center text-red-500 text-sm">${error.message}</p>`;
                console.error("Error parsing articles JSON:", error);
            }
        }


        /**
         * Toggles the visibility of the admin editor mode.
         */
        function toggleAdminMode() {
            const isHidden = editorMode.classList.contains('hidden');
            if (isHidden) {
                // Populate the editor with the current article data (formatted nicely)
                try {
                    jsonEditor.value = JSON.stringify(articles, null, 4);
                } catch (e) {
                    jsonEditor.value = "Error: Could not stringify current articles object.";
                }
                editorMode.classList.remove('hidden');
                articleGrid.classList.add('opacity-50', 'pointer-events-none');
                toggleBtn.textContent = 'Disable Editor Mode';
            } else {
                editorMode.classList.add('hidden');
                articleGrid.classList.remove('opacity-50', 'pointer-events-none');
                toggleBtn.textContent = 'Enable Editor Mode (Collaborators Only)';
            }
        }

        /**
         * Generates the new JavaScript code snippet for the Google Site embed.
         */
        function generateCodeSnippet() {
            const outputArea = document.getElementById('code-snippet-output');
            const generatedCode = document.getElementById('generated-code');
            
            try {
                // Safely get the JSON from the editor and format it back to a string
                const articlesObj = JSON.parse(jsonEditor.value);
                
                // Use a simple, un-formatted JSON string for easier pasting into the JS code block
                const jsonString = JSON.stringify(articlesObj, null, 4).replace(/`/g, '\\`');

                const codeSnippet = `let articles = ${jsonString};`;

                generatedCode.value = codeSnippet;
                outputArea.classList.remove('hidden');

                // Copy to clipboard logic
                document.execCommand('copy'); 
                
                toggleBtn.textContent = 'Code Copied! Replace Old Code Block';
                setTimeout(() => {
                    toggleBtn.textContent = 'Disable Editor Mode';
                }, 3000);

            } catch (error) {
                generatedCode.value = `Invalid JSON structure. ERR: ${error.message}`;
                outputArea.classList.remove('hidden');
            }
        }


        /**
         * Handles the opening of the modal with the full section content.
         */
        function openModal(articleKey) {
            const article = articles[articleKey];
            if (!article) return;

            // Update modal content
            modalTitle.innerHTML = `<span class="text-sm font-semibold uppercase text-light-blue block">${article.category || 'Section'}</span>${article.title || 'Untitled'}`;
            modalBody.innerHTML = article.content || '<p>Content missing.</p>';
            if (article.author) {
                modalBody.innerHTML += `<p class="mt-6 text-right font-semibold text-sm italic">— By ${article.author}</p>`;
            }


            // Show modal and prevent background scrolling
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.classList.add('opacity-100');
            body.style.overflow = 'hidden';
            
            // Focus on the close button for accessibility (optional but good practice)
            modal.querySelector('button').focus();
        }

        /**
         * Closes the section modal.
         */
        function closeModal() {
            // Hide modal and re-enable background scrolling
            modal.classList.remove('opacity-100');
            modal.classList.add('opacity-0', 'pointer-events-none');
            body.style.overflow = '';
        }

        // --- Initialization and Event Listeners ---
        window.onload = function() {
            loadArticles();
        };

        // Close modal when clicking outside or pressing ESC
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('opacity-100')) {
                closeModal();
            }
        });
    </script>

</body>
</html>
